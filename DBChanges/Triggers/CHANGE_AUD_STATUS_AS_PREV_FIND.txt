DROP TRIGGER AUDIT_STAG_TEST.CHANGE_AUD_STATUS_AS_PREV_FIND;

CREATE OR REPLACE TRIGGER AUDIT_STAG_TEST."CHANGE_AUD_STATUS_AS_PREV_FIND"  
AFTER UPDATE ON AUDIT_STAG_TEST.AUDIT_FINDINGS FOR EACH ROW
DECLARE

v_newAdtStatus Number;

BEGIN

DBMS_OUTPUT.PUT_LINE('firing');

DBMS_OUTPUT.PUT_LINE('outside');
IF :OLD.AUDIT_STATUS IS NULL OR :NEW.AUDIT_STATUS <> :OLD.AUDIT_STATUS THEN
 DBMS_OUTPUT.PUT_LINE('inside');

IF :NEW.AUDIT_STATUS = 1 THEN
 v_newAdtStatus := 1002;

ELSIF :NEW.AUDIT_STATUS = 0 THEN
  v_newAdtStatus := 1001;
END IF;

DBMS_OUTPUT.PUT_LINE('v_newAdtStatus ' || v_newAdtStatus);

IF v_newAdtStatus IS NOT NULL THEN
UPDATE AUDIT_DETAILS SET AUDIT_STATUS_ID = v_newAdtStatus WHERE AUDIT_SEQ_NO = :NEW.AUDIT_SEQ_NO AND COMPANY_ID = :NEW.COMPANY_ID AND LOCK_STATUS<>2;
END IF;

END IF;

END;
/
