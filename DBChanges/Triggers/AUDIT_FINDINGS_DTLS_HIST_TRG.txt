DROP TRIGGER AUDIT_STAG_TEST.AUDIT_FINDINGS_DTLS_HIST_TRG;

CREATE OR REPLACE TRIGGER AUDIT_STAG_TEST."AUDIT_FINDINGS_DTLS_HIST_TRG"  
BEFORE INSERT OR UPDATE ON AUDIT_STAG_TEST.AUDIT_FINDINGS_DETAILS FOR EACH ROW
DECLARE
v_status varchar2(100);

BEGIN

IF(:new.AUDIT_TYPE_ID <> 1004) THEN 

v_status := 'INSERTED';

IF UPDATING THEN
    v_status := 'UPDATED';
    END IF;
    END IF;
 
Insert into AUDIT_FINDINGS_DETAILS_HISTORY(AUDIT_HISTORY_SEQ_NO,
STATUS_SEQ_NO,
CUR_AUDIT_SEQ_NO,
ORIG_SEQ_NO,
FINDING_SEQ_NO,
FINDING_CATEGORY_ID,
STATUS_ID,
STATUS_DATE,
NEXT_ACTION_ID,
DUE_DATE,
DESCRIPTION,
AUDIT_TYPE_ID,
AUDIT_HISTORY_STATUS,
COMPANY_ID,
USER_INS,
DATE_INS
)values(
AUDIT_FINDING_DETAILS_SEQ_NO.NEXTVAL,
:new.STATUS_SEQ_NO,
:new.CUR_AUDIT_SEQ_NO,
:new.ORIG_SEQ_NO,
:new.FINDING_SEQ_NO,
:new.FINDING_CATEGORY_ID,
:new.STATUS_ID,
:new.STATUS_DATE,
:new.NEXT_ACTION_ID,
:new.DUE_DATE,
:new.DESCRIPTION,
:new.AUDIT_TYPE_ID,
v_status,
:new.COMPANY_ID,
:new.USER_INS,
:new.DATE_INS
);


  
END;
/
