DROP TRIGGER AUDIT_STAG_TEST.COMPANY_IMO_HISTORY_TRG;

CREATE OR REPLACE TRIGGER AUDIT_STAG_TEST."COMPANY_IMO_HISTORY_TRG"   
AFTER INSERT OR UPDATE OR DELETE  ON AUDIT_STAG_TEST.MA_VESSEL FOR EACH ROW
BEGIN  
    IF UPDATING  AND :NEW.COMPANY_IMO_NO  != NULL THEN
        IF :NEW.COMPANY_IMO_NO <> :OLD.COMPANY_IMO_NO THEN                    
            INSERT INTO COMPANY_IMO_CHANGE (SEQ_NO,VESSEL_IMO_NO,COMPANY_ID,COMPANY_IMO_NO,USER_INS,DATE_INS ) values(DOC_HISTORY_SEQ.NEXTVAL,:NEW.VESSEL_IMO_NO,:NEW.COMPANY_ID,:NEW.COMPANY_IMO_NO,:NEW.USER_INS,:NEW.DATE_INS);
            UPDATE AUDIT_DETAILS  SET DOC_FLAG=0 WHERE VESSEL_IMO_NO = :NEW.VESSEL_IMO_NO AND COMPANY_ID = :NEW.COMPANY_ID AND AUDIT_STATUS_ID=1001;
        END IF;
   -- ELSE
      --  INSERT INTO COMPANY_IMO_CHANGE (SEQ_NO,VESSEL_IMO_NO,COMPANY_ID,COMPANY_IMO_NO,USER_INS,DATE_INS ) values(DOC_HISTORY_SEQ.NEXTVAL,:NEW.VESSEL_IMO_NO,:NEW.COMPANY_ID,:NEW.COMPANY_IMO_NO,:NEW.USER_INS,:NEW.DATE_INS);
    END IF;
    
    IF INSERTING THEN
        update master_table_update set table_updation=0 where table_name='Vessel';
        END IF;
        IF DELETING THEN 
            update master_table_update set table_updation=0 where table_name='Vessel';
            END IF ;
END;
/
