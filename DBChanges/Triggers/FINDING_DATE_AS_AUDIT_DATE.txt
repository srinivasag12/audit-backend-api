DROP TRIGGER AUDIT_STAG_TEST.FINDING_DATE_AS_AUDIT_DATE;

CREATE OR REPLACE TRIGGER AUDIT_STAG_TEST."FINDING_DATE_AS_AUDIT_DATE"  
BEFORE INSERT OR UPDATE ON AUDIT_STAG_TEST.AUDIT_FINDINGS FOR EACH ROW
DECLARE

v_auditDate Date;

BEGIN

IF :OLD.AUDIT_SEQ_NO IS NOT NULL AND  :OLD.COMPANY_ID IS NOT NULL THEN
   SELECT AUDIT_DATE INTO v_auditDate FROM AUDIT_DETAILS WHERE AUDIT_SEQ_NO=:OLD.AUDIT_SEQ_NO AND COMPANY_ID = :OLD.COMPANY_ID;
ELSIF :NEW.AUDIT_SEQ_NO IS NOT NULL AND  :NEW.COMPANY_ID IS NOT NULL THEN
   SELECT AUDIT_DATE INTO v_auditDate FROM AUDIT_DETAILS WHERE AUDIT_SEQ_NO=:NEW.AUDIT_SEQ_NO AND COMPANY_ID = :NEW.COMPANY_ID;
END IF;

IF v_auditDate IS NOT NULL THEN
:NEW.AUDIT_DATE:=v_auditDate;
END IF;

END;
/
