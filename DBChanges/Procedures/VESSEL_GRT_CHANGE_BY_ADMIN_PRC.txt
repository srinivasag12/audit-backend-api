CREATE OR REPLACE PROCEDURE AUDIT_STAG_TEST.Vessel_GRT_Change_by_admin_Prc (pVslImoNo     VARCHAR2,
                                                   pOldVal       NUMBER,
                                                   pNewval       NUMBER)
AS
vTo varchar2(200);--:=audit_details_pkg.v_admin;
vaudit_status_id NUMBER;
   vSub    VARCHAR2 (1000);
   vBody   VARCHAR2 (1000);
   vCC     VARCHAR2 (1000);
BEGIN
select user_id into vTo from ma_user_roles where role_id=1002;
   SELECT muliple_replace_fun (subject,
                               NEW t_text ('RMI Admin'),
                               NEW t_text ('RMI Admin'||vTo)),
          muliple_replace_fun (
             body,
             NEW t_text ('Old Value__',
                         'New Value___(Latest)',
                         'Admin ___',
                         'Vessel IMO No.___'),
             t_text ('Old Value ' || pOldVal,
                     'New Value ' || pNewval,
                     'Admin ' ||vTo,
                     'Vessel IMO No ' || pVslImoNo || '..!!!'))
     INTO vSub, vBody
     FROM (SELECT subject, body
             FROM audit_email_dtls
            WHERE email_seq = 36);

if vaudit_status_id =1002 then
   SELECT listagg (user_id, ',') WITHIN GROUP (ORDER BY role_id ASC)
     INTO vCC
     FROM ma_user_roles
    WHERE role_id in(SELECT role_id
                       FROM ma_roles
                      WHERE role_desc in ('Auditor','Manager'));
                      end if;
dbms_output.put_line(pVslImoNo);
dbms_output.put_line(audit_details_pkg.v_From);
dbms_output.put_line(audit_details_pkg.v_admin);
dbms_output.put_line(vCC);
dbms_output.put_line(vSub);
dbms_output.put_line(vBody);


  audit_send_mail_prc (
      'Updating of GRT value for the Vessel IMO No ' || pVslImoNo,
      NULL,
      audit_details_pkg.v_From,
      audit_details_pkg.v_admin,
      vCC,
      vSub,
      vBody);
END;
/
