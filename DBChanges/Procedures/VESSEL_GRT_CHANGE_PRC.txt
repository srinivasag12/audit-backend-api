CREATE OR REPLACE PROCEDURE AUDIT_STAG_TEST.Vessel_GRT_Change_Prc (pVslImoNo     VARCHAR2,
                                                   pOldVal       NUMBER,
                                                   pNewval       NUMBER,
                                                   pUpdatedBy    VARCHAR2,
                                                   pLeadAud      VARCHAR2)
AS
   vSub    VARCHAR2 (1000);
   vBody   VARCHAR2 (1000);
   vCC     VARCHAR2 (1000);
BEGIN
   SELECT muliple_replace_fun (subject,
                               NEW t_text (' Lead Auditor'),
                               NEW t_text (pUpdatedBy)),
          muliple_replace_fun (
             body,
             NEW t_text ('Old Value__',
                         'New Value___(Latest)',
                         'Lead Auditor ___',
                         'Vessel IMO No.___'),
             t_text ('Old Value ' || pOldVal,
                     'New Value ' || pNewval,
                     'Lead Auditor ' || pUpdatedBy,
                     'Vessel IMO No ' || pVslImoNo || '..!!!'))
     INTO vSub, vBody
     FROM (SELECT subject, body
             FROM audit_email_dtls
            WHERE email_seq = 26);


   SELECT listagg (user_id, ',') WITHIN GROUP (ORDER BY role_id ASC)
     INTO vCC
     FROM ma_user_roles
    WHERE role_id = (SELECT role_id
                       FROM ma_roles
                      WHERE role_desc LIKE 'Manager');
/*dbms_output.put_line(pVslImoNo);
dbms_output.put_line(audit_details_pkg.v_From);
dbms_output.put_line(audit_details_pkg.v_admin);
dbms_output.put_line(vCC);
dbms_output.put_line(vSub);
dbms_output.put_line(vBody);

*/
  /* audit_send_mail_prc (
      'Updating of GRT value for the Vessel IMO No ' || pVslImoNo,
      NULL,
      audit_details_pkg.v_From,
      audit_details_pkg.v_admin,
      vCC,
      vSub,
      vBody);*/
END;
/
