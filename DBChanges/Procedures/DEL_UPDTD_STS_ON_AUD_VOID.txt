CREATE OR REPLACE PROCEDURE AUDIT_STAG_TEST.DEL_UPDTD_STS_ON_AUD_VOID(p_auditSeqNo NUMBER , p_companyId NUMBER)
AS
CURSOR C1 IS SELECT  ORIG_SEQ_NO, FINDING_SEQ_NO FROM AUDIT_FINDINGS_DETAILS WHERE CUR_AUDIT_SEQ_NO=p_auditSeqNo AND COMPANY_ID = p_companyId AND CUR_AUDIT_SEQ_NO<>ORIG_SEQ_NO;
v_cursCurAudSeq               NUMBER;
v_cursFindSeqNo               NUMBER;
BEGIN

      OPEN C1;
      
      FETCH C1 INTO v_cursCurAudSeq,v_cursFindSeqNo;
      
      UPDATE AUDIT_FINDINGS SET FINDING_STATUS=0, AUDIT_STATUS=0 WHERE AUDIT_SEQ_NO=v_cursCurAudSeq AND FINDING_SEQ_NO=v_cursFindSeqNo AND COMPANY_ID=p_companyId;
      
      CLOSE C1;
      
      
      DELETE FROM AUDIT_FINDING_ATTACHMENTS WHERE CUR_AUDIT_SEQ_NO=p_auditSeqNo AND COMPANY_ID = p_companyId AND CUR_AUDIT_SEQ_NO<>ORIG_SEQ_NO;
      DELETE FROM AUDIT_FINDINGS_DETAILS WHERE CUR_AUDIT_SEQ_NO=p_auditSeqNo AND COMPANY_ID = p_companyId AND CUR_AUDIT_SEQ_NO<>ORIG_SEQ_NO;
      COMMIT;
 END;
/
