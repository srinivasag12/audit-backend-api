CREATE OR REPLACE PROCEDURE LOCAL_AUDIT_CHANGES.REISSUE_CERTIFICATE_INTERORADD (
   p_vessel_imo          NUMBER,
   p_audit_seq_no        NUMBER,
   p_certificate_no      VARCHAR2,
   p_audit_type_id       NUMBER,
   p_audit_subType_id    NUMBER,
   p_company_id          NUMBER,
   p_status              VARCHAR2)
AS
   v_audit_seq_no                NUMBER;
   v_issuer_sign                 BLOB;
   v_issuer_sign_date            DATE;
   v_issuer_name                 VARCHAR2 (100 BYTE);
   v_title                       VARCHAR2 (200 BYTE);
   v_certificate_id              NUMBER;
   v_certificate_issue_id        NUMBER;
   v_extended_issue_date         DATE;
   v_extended_expiry_date        DATE;
   v_extended_endorsed_date      DATE;
   v_publish_status              NUMBER;
   v_active_status               NUMBER;
   v_name_to_print               NUMBER;
   v_sign_to_print               NUMBER;
   v_utn                         VARCHAR2 (30 BYTE);
   v_qrcode_url                  VARCHAR2 (400 BYTE);
   v_certificate_no              VARCHAR2 (50 BYTE);
   v_update_audit_seq_no         NUMBER;
   v_certificate_link            NUMBER;
   v_audit_sub_type_id           NUMBER;
   v_uni_audit_seq_no            NUMBER;
   check_status_value            VARCHAR2 (50);
   check_exten_or_interAdditon   VARCHAR2 (50);
   v_count_val                   NUMBER;
   vErrMsg                       VARCHAR2 (200);
   v_check_sample                NUMBER;
   v_prev_audit_type_id          NUMBER;
   v_prev_audit_sub_type_id      NUMBER;
   V_Re_Count                    NUMBER;
   v_user_ins                    VARCHAR2 (200 BYTE);
   v_issuer_id                   VARCHAR2 (100 BYTE);
   Cur1                          SYS_REFCURSOR;
   V_VESSEL_COMPANY_ADDRESS      VARCHAR2 (500 BYTE);
   V_VESSEL_COMPANY_NAME         VARCHAR2 (100 BYTE);
   V_DOC_EXPIRY                  DATE;
   V_DOC_ISSUER                  VARCHAR2 (200 BYTE);
   V_VESSEL_NAME                 VARCHAR2 (200 BYTE);
   V_DATE_OF_REGISTRY            DATE;
   V_VESSEL_TYPE                 VARCHAR2 (50 BYTE);
   V_COMPANY_IMO_NO              VARCHAR2 (30 BYTE);
   V_GRT                         INTEGER;
   V_PORT_OF_REGISTRY            VARCHAR2 (20 BYTE);
   V_VESSEL_ID                   NUMBER;
BEGIN
   SELECT REGEXP_SUBSTR (p_status,
                         '[^-]+',
                         1,
                         1),
          REGEXP_SUBSTR (p_status,
                         '[^-]+',
                         1,
                         2)
     INTO check_status_value, check_exten_or_interAdditon
     FROM DUAL;

   IF (check_exten_or_interAdditon <> 'EXTENSION')
   THEN
      OPEN Cur1 FOR
           SELECT Audit_Seq_No, Audit_Type_Id, Audit_Sub_Type_Id
             FROM Audit_Details
            WHERE     vessel_imo_no = p_vessel_imo
                  AND audit_sub_type_id NOT IN (1001, 1003, 1005)
                  AND audit_type_id = p_audit_type_id
                  AND company_id = p_company_id
                  AND audit_status_id <> 1004
                  AND audit_summary_id <> 1005
         ORDER BY Audit_Seq_No DESC;

      LOOP
         FETCH Cur1
         INTO V_Uni_Audit_Seq_No,
              v_prev_audit_type_id,
              v_prev_audit_sub_type_id;


         IF (v_prev_audit_sub_type_id = 1004)
         THEN
            SELECT COUNT (Audit_Seq_No)
              INTO V_Re_Count
              FROM Certificate_Detail
             WHERE     Audit_Seq_No = V_Uni_Audit_Seq_No
                   AND Audit_Type_Id = v_prev_audit_type_id
                   AND Audit_Sub_Type_Id = v_prev_audit_sub_type_id
                   AND Certificate_Issue_Id = 1002;
         END IF;

          IF (V_Audit_Sub_Type_Id = 1002)
              /*IF (v_prev_audit_sub_type_id = 1002) */
         THEN
            V_Re_Count := 1;
         END IF;

         EXIT WHEN V_Re_Count > 0 OR Cur1%NOTFOUND;
      END LOOP;
   END IF;



   IF (check_exten_or_interAdditon = 'EXTENSION')
   THEN
      SELECT COUNT (AUDIT_SEQ_NO)
        INTO v_count_val
        FROM AUDIT_DETAILS
       WHERE     AUDIT_SEQ_NO > P_AUDIT_SEQ_NO
             AND COMPANY_ID = P_COMPANY_ID
             AND VESSEL_IMO_NO = P_VESSEL_IMO
             AND AUDIT_STATUS_ID <> 1004
             AND AUDIT_SUMMARY_ID <> 1005
             AND AUDIT_SUB_TYPE_ID IN (1003, 1004, 1005);

      IF v_count_val > 0
      THEN
         FOR I
            IN (  SELECT A.AUDIT_SEQ_NO
                    FROM AUDIT_DETAILS A
                   WHERE     A.VESSEL_IMO_NO = P_VESSEL_IMO
                         AND A.AUDIT_TYPE_ID = P_AUDIT_TYPE_ID
                         AND A.AUDIT_SEQ_NO <> P_AUDIT_SEQ_NO
                         AND A.AUDIT_SEQ_NO > P_AUDIT_SEQ_NO
                         AND A.COMPANY_ID = P_COMPANY_ID
                         AND A.AUDIT_STATUS_ID <> 1004
                         AND A.AUDIT_SUMMARY_ID <> 1005
                         AND A.AUDIT_SUB_TYPE_ID IN (1003, 1004, 1005)
                ORDER BY A.AUDIT_SEQ_NO DESC)
         LOOP
            v_audit_seq_no := I.AUDIT_SEQ_NO;


            DELETE FROM certificate_detail
                  WHERE     audit_Seq_no = v_audit_seq_no
                        AND company_id = p_company_id
                        AND certificate_issue_id = 1003
                        AND vessel_imo_no = p_vessel_imo
                        AND publish_status = 0
                        AND seq_no =
                               (SELECT MAX (seq_no)
                                  FROM certificate_detail
                                 WHERE     audit_Seq_no = v_audit_seq_no
                                       AND company_id = p_company_id
                                       AND certificate_issue_id = 1003
                                       AND vessel_imo_no = p_vessel_imo);

            UPDATE certificate_detail
               SET ACTIVE_STATUS = 0
             WHERE     COMPANY_ID = p_company_id
                   AND vessel_imo_no = p_vessel_imo
                   AND audit_type_id = p_audit_type_id
                   AND AUDIT_SEQ_NO = v_audit_seq_no
                   AND CERTIFICATE_ISSUE_ID = 1003;

              SELECT CERTIFICATE_ID,
                     CERTIFICATE_NO,
                     CERTIFICATE_ISSUE_ID,
                     EXTENDED_ISSUE_DATE,
                     EXTENDED_EXPIRY_DATE,
                     PUBLISH_STATUS,
                     ACTIVE_STATUS,
                     NAME_TO_PRINT,
                     SIGN_TO_PRINT,
                     UTN,
                     QRCODE_URL,
                     CERTIFICATE_LINK_SEQ,
                     EXTENDED_ENDORSED_DATE,
                     ISSUER_ID,
                     USER_INS,
                     ISSUER_SIGN,
                     ISSUER_NAME,
                     ISSUER_SIGN_DATE
                INTO v_certificate_id,
                     v_certificate_no,
                     v_certificate_issue_id,
                     v_extended_issue_date,
                     v_extended_expiry_date,
                     v_publish_status,
                     v_active_status,
                     v_name_to_print,
                     v_sign_to_print,
                     v_utn,
                     v_qrcode_url,
                     v_certificate_link,
                     v_extended_endorsed_date,
                     v_issuer_id,
                     v_user_ins,
                     v_issuer_sign,
                     v_issuer_name,
                     v_issuer_sign_date
                FROM certificate_detail
               WHERE     vessel_imo_no = p_vessel_imo
                     AND audit_type_id = p_audit_type_id
                     AND AUDIT_SEQ_NO = p_audit_seq_no
                     AND AUDIT_SUB_TYPE_ID = p_audit_subType_id
                     AND CERTIFICATE_ISSUE_ID = 1003
                     AND COMPANY_ID = p_company_id
                     AND ROWNUM = 1
                     AND SEQ_NO =
                            (SELECT MAX (SEQ_NO)
                               FROM certificate_detail
                              WHERE     AUDIT_SEQ_NO = p_audit_seq_no
                                    AND company_id = p_company_id
                                    AND audit_type_id = p_audit_type_id
                                    AND AUDIT_SUB_TYPE_ID = p_audit_subType_id
                                    AND CERTIFICATE_ISSUE_ID = 1003)
            ORDER BY SEQ_NO DESC;

            INSERT INTO certificate_detail (AUDIT_SEQ_NO,
                                            COMPANY_ID,
                                            SEQ_NO,
                                            CERTIFICATE_ID,
                                            AUDIT_TYPE_ID,
                                            AUDIT_SUB_TYPE_ID,
                                            AUDIT_DATE,
                                            AUDIT_PLACE,
                                            CERTIFICATE_NO,
                                            AUDIT_REPORT_NO,
                                            UTN,
                                            CERTIFICATE_ISSUE_ID,
                                            QRCODE_URL,
                                            CERTIFICATE_VERSION,
                                            CERT_ISSUED_DATE,
                                            CERT_EXPIRY_DATE,
                                            EXTENDED_ISSUE_DATE,
                                            EXTENDED_EXPIRY_DATE,
                                            PUBLISH_STATUS,
                                            ACTIVE_STATUS,
                                            NOTES,
                                            LEAD_NAME,
                                            ISSUER_ID,
                                            ISSUER_NAME,
                                            ISSUER_SIGN,
                                            ISSUER_SIGN_DATE,
                                            NAME_TO_PRINT,
                                            SIGN_TO_PRINT,
                                            VERIFY_DONE,
                                            VESSEL_ID,
                                            VESSEL_IMO_NO,
                                            VESSEL_NAME,
                                            GRT,
                                            VESSEL_TYPE,
                                            OFFICIAL_NO,
                                            PORT_OF_REGISTRY,
                                            DATE_OF_REGISTRY,
                                            COMPANY_IMO_NO,
                                            VESSEL_COMPANY_NAME,
                                            VESSEL_COMPANY_ADDRESS,
                                            VESSEL_UK,
                                            VESSEL_PK,
                                            CLASS_SOCIETY,
                                            CALL_SIGN,
                                            DOC_TYPE_NUMBER,
                                            DOC_TYPE,
                                            DOC_ISSUER,
                                            DOC_EXPIRY,
                                            USER_INS,
                                            DATE_INS,
                                            SEAL,
                                            TITLE,
                                            CERTIFICATE_LINK_SEQ,
                                            EXTENDED_ENDORSED_DATE)
               SELECT *
                 FROM (  SELECT v_audit_seq_no,
                                COMPANY_ID,
                                (SELECT MAX (seq_no) + 1
                                   FROM certificate_detail
                                  WHERE audit_seq_no = v_audit_seq_no
                                        AND COMPANY_ID = p_company_id),
                                v_certificate_id,
                                AUDIT_TYPE_ID,
                                AUDIT_SUB_TYPE_ID,
                                AUDIT_DATE,
                                AUDIT_PLACE,
                                v_certificate_no,
                                AUDIT_REPORT_NO,
                                v_utn,
                                v_certificate_issue_id,
                                v_qrcode_url,
                                CERTIFICATE_VERSION,
                                CERT_ISSUED_DATE,
                                CERT_EXPIRY_DATE,
                                v_extended_issue_date,
                                v_extended_expiry_date,
                                v_publish_status,
                                /*commented by cb*/
                             /*   v_active_status*/1,
                                NOTES,
                                LEAD_NAME,
                                v_issuer_id,
                                v_issuer_name,
                                v_issuer_sign,
                                v_issuer_sign_date,
                                v_name_to_print,
                                v_sign_to_print,
                                VERIFY_DONE,
                                VESSEL_ID,
                                VESSEL_IMO_NO,
                                VESSEL_NAME,
                                GRT,
                                VESSEL_TYPE,
                                OFFICIAL_NO,
                                PORT_OF_REGISTRY,
                                DATE_OF_REGISTRY,
                                COMPANY_IMO_NO,
                                VESSEL_COMPANY_NAME,
                                VESSEL_COMPANY_ADDRESS,
                                VESSEL_UK,
                                VESSEL_PK,
                                CLASS_SOCIETY,
                                CALL_SIGN,
                                DOC_TYPE_NUMBER,
                                DOC_TYPE,
                                DOC_ISSUER,
                                DOC_EXPIRY,
                                v_user_ins,
                                DATE_INS,
                                SEAL,
                                TITLE,
                                v_certificate_link,
                                v_extended_endorsed_date
                           FROM certificate_detail
                          WHERE     VESSEL_IMO_NO = p_vessel_imo
                                AND AUDIT_SEQ_NO = v_audit_seq_no
                                AND audit_type_id = p_audit_type_id
                                AND company_id = p_company_id
                       ORDER BY seq_no DESC)
                WHERE ROWNUM = 1;
         END LOOP;
      END IF;
   ELSE
      SELECT VCMP.VESSEL_COMPANY_ADDRESS,
             VCMP.VESSEL_COMPANY_NAME,
             VCMP.DOC_EXPIRY,
             VCMP.DOC_ISSUER,
             VES.VESSEL_NAME,
             VES.DATE_OF_REGISTRY,
             VES.VESSEL_TYPE,
             VCMP.COMPANY_IMO_NO,
             VES.GRT,
             VES.PORT_OF_REGISTRY,
             VES.VESSEL_ID
        INTO V_VESSEL_COMPANY_ADDRESS,
             V_VESSEL_COMPANY_NAME,
             V_DOC_EXPIRY,
             V_DOC_ISSUER,
             V_VESSEL_NAME,
             V_DATE_OF_REGISTRY,
             V_VESSEL_TYPE,
             V_COMPANY_IMO_NO,
             V_GRT,
             V_PORT_OF_REGISTRY,
             V_VESSEL_ID
        FROM    MA_VESSEL VES
             JOIN
                MA_VESSEL_COMPANY VCMP
             ON VCMP.COMPANY_IMO_NO = VES.COMPANY_IMO_NO
       WHERE VES.VESSEL_IMO_NO = p_vessel_imo;

     IF (check_status_value = 'INSERT')
      THEN
         dbms_output.put_line ('inside insert-- trgg reissue_certificate_interod');
         FOR I
            IN (  SELECT A.AUDIT_SEQ_NO
                    FROM AUDIT_DETAILS A
                   WHERE     A.VESSEL_IMO_NO = P_VESSEL_IMO
                         AND A.AUDIT_TYPE_ID = P_AUDIT_TYPE_ID
                         AND A.AUDIT_SEQ_NO >= v_uni_audit_seq_no
                         AND A.AUDIT_SEQ_NO <> p_audit_seq_no
                         AND A.COMPANY_ID = P_COMPANY_ID
                         AND A.AUDIT_STATUS_ID <> 1004
                         AND A.AUDIT_SUMMARY_ID <> 1005
                ORDER BY A.AUDIT_SEQ_NO DESC)
         LOOP
            v_audit_seq_no := I.AUDIT_SEQ_NO;

          /*commented by cb */

          /*  UPDATE certificate_detail
               SET ACTIVE_STATUS = 0
             WHERE     COMPANY_ID = p_company_id
                   AND audit_type_id = p_audit_type_id
                   AND AUDIT_SEQ_NO = v_audit_seq_no; */
                  

              SELECT CERTIFICATE_ID,
                     CERTIFICATE_NO,
                     CERTIFICATE_ISSUE_ID,
                     EXTENDED_ISSUE_DATE,
                     EXTENDED_EXPIRY_DATE,
                     PUBLISH_STATUS,
                     ACTIVE_STATUS,
                     NAME_TO_PRINT,
                     SIGN_TO_PRINT,
                     UTN,
                     QRCODE_URL,
                     CERTIFICATE_LINK_SEQ,
                     ISSUER_ID,
                     ISSUER_NAME,
                     ISSUER_SIGN,
                     ISSUER_SIGN_DATE,
                     USER_INS
                INTO v_certificate_id,
                     v_certificate_no,
                     v_certificate_issue_id,
                     v_extended_issue_date,
                     v_extended_expiry_date,
                     v_publish_status,
                     v_active_status,
                     v_name_to_print,
                     v_sign_to_print,
                     v_utn,
                     v_qrcode_url,
                     v_certificate_link,
                     v_issuer_id,
                     v_issuer_name,
                     v_issuer_sign,
                     v_issuer_sign_date,
                     v_user_ins
                FROM certificate_detail
               WHERE     vessel_imo_no = p_vessel_imo
                     AND audit_type_id = p_audit_type_id
                     AND AUDIT_SEQ_NO = p_audit_seq_no
                     AND AUDIT_SUB_TYPE_ID = p_audit_subType_id
                     AND CERTIFICATE_ISSUE_ID = 1008
                     AND COMPANY_ID = p_company_id
                     AND SEQ_NO =
                            (SELECT MAX (SEQ_NO)
                               FROM certificate_detail
                              WHERE     AUDIT_SEQ_NO = p_audit_seq_no
                                    AND company_id = p_company_id
                                    AND audit_type_id = p_audit_type_id
                                    AND AUDIT_SUB_TYPE_ID = p_audit_subType_id
                                    AND CERTIFICATE_ISSUE_ID = 1008)
                    AND ROWNUM = 1
            ORDER BY SEQ_NO DESC;

            INSERT INTO certificate_detail (AUDIT_SEQ_NO,
                                            COMPANY_ID,
                                            SEQ_NO,
                                            CERTIFICATE_ID,
                                            AUDIT_TYPE_ID,
                                            AUDIT_SUB_TYPE_ID,
                                            AUDIT_DATE,
                                            AUDIT_PLACE,
                                            CERTIFICATE_NO,
                                            AUDIT_REPORT_NO,
                                            UTN,
                                            CERTIFICATE_ISSUE_ID,
                                            QRCODE_URL,
                                            CERTIFICATE_VERSION,
                                            CERT_ISSUED_DATE,
                                            CERT_EXPIRY_DATE,
                                            EXTENDED_ISSUE_DATE,
                                            EXTENDED_EXPIRY_DATE,
                                            PUBLISH_STATUS,
                                            ACTIVE_STATUS,
                                            NOTES,
                                            LEAD_NAME,
                                            ISSUER_ID,
                                            ISSUER_NAME,
                                            ISSUER_SIGN,
                                            ISSUER_SIGN_DATE,
                                            NAME_TO_PRINT,
                                            SIGN_TO_PRINT,
                                            VERIFY_DONE,
                                            VESSEL_ID,
                                            VESSEL_IMO_NO,
                                            VESSEL_NAME,
                                            GRT,
                                            VESSEL_TYPE,
                                            OFFICIAL_NO,
                                            PORT_OF_REGISTRY,
                                            DATE_OF_REGISTRY,
                                            COMPANY_IMO_NO,
                                            VESSEL_COMPANY_NAME,
                                            VESSEL_COMPANY_ADDRESS,
                                            VESSEL_UK,
                                            VESSEL_PK,
                                            CLASS_SOCIETY,
                                            CALL_SIGN,
                                            DOC_TYPE_NUMBER,
                                            DOC_TYPE,
                                            DOC_ISSUER,
                                            DOC_EXPIRY,
                                            USER_INS,
                                            DATE_INS,
                                            SEAL,
                                            TITLE,
                                            CERTIFICATE_LINK_SEQ,
                                            DMLCII_ISSUE_LOCATION,
                                            COMPLETION_DATE,
                                            DMLCII_ISSUE_DATE)
               SELECT *
                 FROM (  SELECT v_audit_seq_no,
                                COMPANY_ID,
                                (SELECT MAX (seq_no) + 1
                                   FROM certificate_detail
                                  WHERE audit_seq_no = v_audit_seq_no
                                        AND COMPANY_ID = p_company_id),
                                v_certificate_id,
                                AUDIT_TYPE_ID,
                                AUDIT_SUB_TYPE_ID,
                                AUDIT_DATE,
                                AUDIT_PLACE,
                                v_certificate_no,
                                AUDIT_REPORT_NO,
                                v_utn,
                                v_certificate_issue_id,
                                v_qrcode_url,
                                CERTIFICATE_VERSION,
                                CERT_ISSUED_DATE,
                                CERT_EXPIRY_DATE,
                                v_extended_issue_date,
                                v_extended_expiry_date,
                                v_publish_status,
                                /*commented by cb */
                              /* v_active_status */0,
                                NOTES,
                                LEAD_NAME,
                                v_issuer_id,
                                v_issuer_name,
                                v_issuer_sign,
                                v_issuer_sign_date,
                                v_name_to_print,
                                v_sign_to_print,
                                VERIFY_DONE,
                                V_VESSEL_ID,
                                VESSEL_IMO_NO,
                                V_VESSEL_NAME,
                                V_GRT,
                                V_VESSEL_TYPE,
                                OFFICIAL_NO,
                                V_PORT_OF_REGISTRY,
                                V_DATE_OF_REGISTRY,
                                V_COMPANY_IMO_NO,
                                V_VESSEL_COMPANY_NAME,
                                V_VESSEL_COMPANY_ADDRESS,
                                VESSEL_UK,
                                VESSEL_PK,
                                CLASS_SOCIETY,
                                CALL_SIGN,
                                DOC_TYPE_NUMBER,
                                DOC_TYPE,
                                V_DOC_ISSUER,
                                V_DOC_EXPIRY,
                                v_user_ins,
                                DATE_INS,
                                SEAL,
                                TITLE,
                                v_certificate_link,
                                DMLCII_ISSUE_LOCATION,
                                COMPLETION_DATE,
                                DMLCII_ISSUE_DATE
                           FROM certificate_detail
                          WHERE     VESSEL_IMO_NO = p_vessel_imo
                                AND AUDIT_SEQ_NO = v_audit_seq_no
                                AND audit_type_id = p_audit_type_id
                                AND company_id = p_company_id
                       ORDER BY seq_no DESC)
                WHERE ROWNUM = 1;
         END LOOP;
     ELSE
         SELECT extended_issue_date,
                extended_expiry_date,
                publish_status,
                active_status,
                name_to_print,
                sign_to_print
           INTO v_extended_issue_date,
                v_extended_expiry_date,
                v_publish_status,
                v_active_status,
                v_name_to_print,
                v_sign_to_print
           FROM certificate_detail
          WHERE     audit_type_id = p_audit_type_id
                AND company_id = p_company_id
                AND AUDIT_SEQ_NO = p_audit_seq_no
                AND vessel_imo_no = p_vessel_imo
                AND seq_no =
                       (SELECT MAX (seq_no)
                          FROM certificate_detail
                         WHERE     AUDIT_SEQ_NO = p_audit_seq_no
                               AND company_id = p_company_id
                               AND vessel_imo_no = p_vessel_imo);

         FOR I
            IN (  SELECT A.AUDIT_SEQ_NO
                    FROM AUDIT_DETAILS A
                   WHERE     A.VESSEL_IMO_NO = P_VESSEL_IMO
                         AND A.AUDIT_TYPE_ID = P_AUDIT_TYPE_ID
                         AND A.AUDIT_SEQ_NO >= v_uni_audit_seq_no
                         AND A.AUDIT_SEQ_NO <> p_audit_seq_no
                         AND A.COMPANY_ID = P_COMPANY_ID
                         AND A.AUDIT_STATUS_ID <> 1004
                         AND A.AUDIT_SUMMARY_ID <> 1005
                ORDER BY A.AUDIT_SEQ_NO DESC)
         LOOP
            v_audit_seq_no := I.AUDIT_SEQ_NO;

            UPDATE certificate_detail
               SET extended_issue_date = v_extended_issue_date,
                   extended_expiry_date = v_extended_expiry_date,
                   publish_status = v_publish_status,
                   /*commented by cb */
                  active_status =/* v_active_status*/0,
                   name_to_print = v_name_to_print,
                   sign_to_Print = v_sign_to_print,
                   VESSEL_COMPANY_NAME = V_VESSEL_COMPANY_NAME,
                   VESSEL_COMPANY_ADDRESS = V_VESSEL_COMPANY_ADDRESS,
                   DOC_EXPIRY = V_DOC_EXPIRY,
                   DOC_ISSUER = V_DOC_ISSUER,
                   VESSEL_NAME = V_VESSEL_NAME,
                   DATE_OF_REGISTRY = V_DATE_OF_REGISTRY,
                   PORT_OF_REGISTRY = V_PORT_OF_REGISTRY,
                   COMPANY_IMO_NO = V_COMPANY_IMO_NO,
                   VESSEL_TYPE = V_VESSEL_TYPE,
                   GRT = V_GRT,
                   VESSEL_ID = V_VESSEL_ID
             WHERE     AUDIT_SEQ_NO = v_audit_seq_no
                   AND COMPANY_ID = p_company_id
                   AND vessel_imo_no = p_vessel_imo
                   AND seq_no =
                          (SELECT MAX (seq_no)
                             FROM certificate_detail
                            WHERE     AUDIT_SEQ_NO = v_audit_seq_no
                                  AND COMPANY_ID = p_company_id
                                  AND vessel_imo_no = p_vessel_imo);
         END LOOP;
      END IF;
      COMMIT;
   END IF;
   
EXCEPTION
   WHEN OTHERS
   THEN
      vErrMsg := SQLERRM || ' on ' || DBMS_UTILITY.format_error_backtrace;
      audit_send_mail_prc (
         p_audit_no     => 'EXTEN_AFTER_REISSUE_INTERORADD FAILED  '
                          || p_audit_seq_no,
         p_company_id   => p_company_id,
         p_from_mail    => audit_details_pkg.v_from,
         p_to_mail      => audit_details_pkg.V_BSOLTEAM,
         p_subject      => 'extention after reissue intermediate or additional failed',
         p_body         => vErrMsg);
         
END;
/
